<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sui Wallet Detection Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .result {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 12px;
        }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .warning { color: #ffc107; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Sui Wallet Detection Test</h1>
        <p>This is a simple HTML page to test Sui Wallet detection without any framework.</p>
        
        <div>
            <button onclick="testWalletDetection()">Test Wallet Detection</button>
            <button onclick="testConnection()">Test Connection</button>
            <button onclick="clearResults()">Clear Results</button>
        </div>
        
        <div id="results" class="result" style="display: none;"></div>
        
        <div style="margin-top: 20px;">
            <h3>Manual Console Test:</h3>
            <p>Open browser console (F12) and run:</p>
            <code>testWalletDetection()</code>
        </div>
    </div>

    <script>
        function log(message, type = 'info') {
            const results = document.getElementById('results');
            results.style.display = 'block';
            
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'success' ? 'success' : type === 'error' ? 'error' : type === 'warning' ? 'warning' : '';
            
            results.innerHTML += `<span class="${className}">[${timestamp}] ${message}</span>\n`;
        }

        function testWalletDetection() {
            log('üîç Starting Sui Wallet Detection Test...');
            
            // Test 1: Basic environment check
            log(`Secure Context: ${window.isSecureContext ? '‚úÖ Yes' : '‚ùå No'}`);
            log(`User Agent: ${navigator.userAgent}`);
            
            // Test 2: Check for Sui Wallet objects
            const walletObjects = [
                'suiWallet',
                '__sui_wallet__',
                'sui',
                'SuiWallet',
                '__sui_wallet_kit__'
            ];
            
            let foundAny = false;
            walletObjects.forEach(name => {
                try {
                    const obj = window[name];
                    if (obj && typeof obj === 'object') {
                        log(`‚úÖ Found window.${name}`, 'success');
                        log(`   Type: ${typeof obj}`);
                        log(`   Methods: ${Object.keys(obj).join(', ')}`);
                        foundAny = true;
                    } else {
                        log(`‚ùå window.${name} not found`);
                    }
                } catch (e) {
                    log(`‚ùå Error checking window.${name}: ${e.message}`, 'error');
                }
            });
            
            // Test 3: Check all window properties
            log('\nüîç Checking all window properties...');
            const allProps = Object.keys(window).filter(key => 
                key.toLowerCase().includes('sui') || 
                key.toLowerCase().includes('wallet') ||
                key.toLowerCase().includes('dapp')
            );
            
            if (allProps.length > 0) {
                log(`Found ${allProps.length} wallet-related properties:`, 'success');
                allProps.forEach(prop => {
                    const obj = window[prop];
                    log(`‚Ä¢ ${prop}: ${typeof obj}`);
                    if (obj && typeof obj === 'object') {
                        log(`  Methods: ${Object.keys(obj).join(', ')}`);
                    }
                });
            } else {
                log('‚ùå No wallet-related properties found', 'error');
            }
            
            // Test 4: Check Chrome extensions
            log('\nüîç Checking Chrome Extensions API...');
            try {
                if (typeof chrome !== 'undefined' && chrome.runtime) {
                    log('‚úÖ chrome.runtime available', 'success');
                    if (chrome.runtime.getManifest) {
                        log('‚úÖ chrome.runtime.getManifest available', 'success');
                    }
                } else {
                    log('‚ùå chrome.runtime not available', 'error');
                }
            } catch (e) {
                log(`‚ùå Chrome API error: ${e.message}`, 'error');
            }
            
            // Test 5: Check for injected scripts
            log('\nüîç Checking for injected scripts...');
            const scripts = document.querySelectorAll('script');
            let suiScripts = 0;
            scripts.forEach(script => {
                if (script.src && script.src.includes('sui')) {
                    suiScripts++;
                    log(`‚úÖ Found Sui script: ${script.src}`, 'success');
                }
            });
            if (suiScripts === 0) {
                log('‚ùå No Sui-related scripts found', 'error');
            }
            
            // Final result
            if (foundAny) {
                log('\nüéâ Sui Wallet detected! You can try connecting.', 'success');
            } else {
                log('\n‚ùå Sui Wallet not detected. Please check:', 'error');
                log('‚Ä¢ Extension is installed and enabled');
                log('‚Ä¢ Extension is pinned to toolbar');
                log('‚Ä¢ Extension has proper permissions');
                log('‚Ä¢ Try refreshing the page');
                log('‚Ä¢ Try opening Sui Wallet directly first');
            }
        }

        async function testConnection() {
            log('üîÑ Testing wallet connection...');
            
            const wallet = window.suiWallet || window.__sui_wallet__;
            
            if (!wallet) {
                log('‚ùå No wallet object found to test', 'error');
                return;
            }
            
            log(`‚úÖ Found wallet object: ${Object.keys(wallet).join(', ')}`, 'success');
            
            try {
                if (typeof wallet.connect === 'function') {
                    log('üîÑ Testing wallet.connect()...');
                    const result = await wallet.connect();
                    log(`‚úÖ wallet.connect() successful: ${JSON.stringify(result)}`, 'success');
                } else if (typeof wallet.requestPermissions === 'function') {
                    log('üîÑ Testing wallet.requestPermissions()...');
                    await wallet.requestPermissions();
                    log('‚úÖ wallet.requestPermissions() successful', 'success');
                } else {
                    log('‚ö†Ô∏è No connect or requestPermissions method found', 'warning');
                }
                
                if (typeof wallet.getAccounts === 'function') {
                    log('üîÑ Testing wallet.getAccounts()...');
                    const accounts = await wallet.getAccounts();
                    log(`‚úÖ getAccounts() result: ${JSON.stringify(accounts)}`, 'success');
                }
                
            } catch (error) {
                log(`‚ùå Connection test failed: ${error.message}`, 'error');
            }
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
            document.getElementById('results').style.display = 'none';
        }

        // Auto-run test on page load
        window.addEventListener('load', () => {
            log('Page loaded. Click "Test Wallet Detection" to start.');
        });
    </script>
</body>
</html>
